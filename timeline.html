<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>Historical Settings of Chinese Movies, wuxia, period drama, comedies, etc.</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="generator" content="Geany 1.23.1" />
	<style type="text/css">
		body {
		  font: 12px sans-serif;
		  margin-left:20px;
		}

		.axis path,
		.axis line {
		  fill: none;
		  stroke: #000;
		  shape-rendering: crispEdges;
		}

		.y.axis path {
		  display: none;
		}

		.y.axis line {
		  stroke: #777;
		  stroke-dasharray: 2,2;
		}

		/*.nomPeriode {display:none;}*/

		text {
			display:block;
			background-color: #FFFFFF;
			}
	</style>
</head>

<body>
	<h1>Jeff's Personal History Timeline</h1>
	<h2>Tracking historical references</h2>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="./periods.json"></script>
  <script type="text/javascript" src="./events.json"></script>

	<script type="text/javascript">
	// Durée couverte par la frise
	var beginTimeline = -800;
	var endTimeline = 2017;

	// Historical periods (from JSON file)
  var periods = periods_json;
	// Historical Events
	var events = events_json;

	// On associe chaque film à une période
	for (var i = 0; i < events.length; i++) {
		for (var j = 0; j < periods.length; j++) {
			if (events[i][0] >= periods[j][2] && events[i][0] <= periods[j][3]) {
				events[i].push(periods[j][0]);
				break;
			}
		}
	}
	// On ordonne le tableau selon les dates
	events.sort(function(a, b) { return (a[0] < b[0] ? -1 : (a[0] > b[0] ? 1 : 0)); });

	// On détermine l'ordre d'affichage des events
	var order = 1; var oldVar;
	for (var i = 0; i < events.length; i++) {
		order++;
		if (events[i][0] - oldVar > 100 || order >= 27) {
			order = 1;
		}
		events[i].push(order);
		oldVar = events[i][0];
	}

	//~ // On calcule le nombre de events par période
	//~ for (var i = 0; i < periods.length; i++) {
		//~ var nbevents = 0;
		//~ for (var j = 0; j < events.length; j++) {
			//~ if (events[j][4] == periods[i][0])
				//~ nbevents++;
		//~ }
		//~ periods[i].push(nbevents);
	//~ }
	//~

	// Positionnement de la frise
	var margin = {top: 20, right: 150, bottom: 20, left: 1},
    width = 4000 - margin.left - margin.right,
    height = 700 - margin.top - margin.bottom;

	// Frise
	var formatNumber = d3.format(" 1f");

	var x = d3.scale.linear()
		.domain([beginTimeline, endTimeline])
		.range([0, width]);

	var y = d3.scale.linear()
			.domain([0, 30])
			.range([0, height]);

	var xAxis = d3.svg.axis()
		.scale(x)
		.ticks(50)
		.tickFormat(formatNumber)
		.orient("bottom");

	var svg = d3.select("body").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	var gx = svg.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(0," + height + ")")
		.call(xAxis);

	var bar = 30;
	// Affichage des périodes
	svg.append("g").selectAll("periode")
			.data(periods)
			.enter().append("rect")
			.attr("class", "periode")
			.attr("x", function(d) {return x(d[2]);})
			.attr("y", function(d) {if (d[0] % 2 == 0) return height - (bar + 4); else return height - (bar + 4) * 2;}  )
			.attr("width", function(d) {return x(d[3]) - x(d[2]);})
			.attr("height", bar)
			.attr("fill", function(d) {  return "hsl(" + (360 - d[0] * 19) + ",50%,50%)" });
			//~ .on("mouseover", function(d) { d3.select("#nomPeriode" + d[0]).style("display", "block");})
			//~ .on("mouseout", function(d) { d3.select("#nomPeriode" + d[0]).style("display", "none");});

	// Affichage des noms de période
	svg.append("g").selectAll(".nomPeriode")
			.data(periods)
			.enter().append("a")
			.attr("xlink:href", function(d) {return d[4];})
			.append("text")
			.text(function(d) {return d[1];})
			.attr("class", "nomPeriode")
			.attr ("id", function(d) {return "nomPeriode" + d[0];})
			.attr("text-anchor", "middle")
			.attr("x", function(d) {return x((d[2] + d[3]) / 2);})
			.attr("y", function(d) {if (d[0] % 2 == 0) return height - (bar + 4); else return height - (bar + 4) * 2;}  )
			.attr("dy", "1.5em")
			.attr("font-weight", "bold");
			//~ .on("mouseover", function(d) { d3.select("#nomPeriode" + d[0]).style("display", "block");})
			//~ .on("mouseout", function(d) { d3.select("#nomPeriode" + d[0]).style("display", "none");});

	// On génère des lignes pour les events
	svg.append("g").selectAll("ligneFilm")
			.data(events)
			.enter().append("line")
			.attr("class", "ligneFilm")
			.attr("x1", function(d) {return x(d[0]);})
			.attr("y1", function(d) {if (d[4] % 2 == 0) return height - bar; else return height - bar * 2;})
			.attr("x2", function(d) {return x(d[0]);})
			.attr("y2", function(d) {return y(d[5]);})
			.attr("stroke", "grey");

	// Affichage des titres de events
	var titres = svg.append("g").selectAll("titreFilm")
			.data(events)
			.enter().append("a")
			.attr("xlink:href", function(d){if (d[3] === "") return "http://www.imdb.com/find?q=" + d[1] + " " + d[2] + "&s=tt"; else return d[3];})
			.attr("class", function(d) {return "titreFilm";});
	titres.append("text")
			.text(function(d) {return d[1] + " (" +  d[2] + ")";})
			.attr("text-anchor", "left")
			.attr("x", function(d) {return x(d[0]);}  )
			.attr("y", function(d) {return y(d[5]);} )
			.attr("dy", "0.75em")
			.attr("dx", "0.25em");

</script>
<script>
 // var _gaq = _gaq || [];
 //  _gaq.push(['_setAccount', 'UA-9905337-6']);
 //  _gaq.push(['_trackPageview']);

 //  (function() {
 //    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 //    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 //    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 //  })();
</script>
</body>
</html>
